# Setup debugging if SHELL_DEBUG file exists
# Remember if SHELL_DEBUG was already set
was_shell_debug_set_bashrc=
if [ -n "$SHELL_DEBUG" ]; then
    was_shell_debug_set_bashrc=1
    echo ".bashrc: SHELL_DEBUG already set, Set was_shell_debug_set_bashrc=$was_shell_debug_set_bashrc" >> "$HOME/SHELL_DEBUG"
fi

if [ -f "$HOME/SHELL_DEBUG" ]; then
    SHELL_DEBUG=1
    echo ".bashrc: Entering \$HOME/.bashrc" >> "$HOME/SHELL_DEBUG"
fi

# Source .profile only once per shell session
profile_sourced_var="DOT_PROFILE_SOURCED_$$"
if [ -z "${!profile_sourced_var}" ]; then
    [ -r "$HOME"/.profile ] && source "$HOME"/.profile >/dev/null 2>&1
    export "$profile_sourced_var"=1
fi

# Final debug output
if [ -n "$SHELL_DEBUG" ]; then
    echo ".bashrc: Exiting \$HOME/.bashrc" >> "$HOME/SHELL_DEBUG"
    # Unset SHELL_DEBUG if we set it in this script
    [ -z "$was_shell_debug_set_bashrc" ] && unset SHELL_DEBUG
fi
unset was_shell_debug_set_bashrc
